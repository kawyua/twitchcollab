{% extends "success.html" %}
{% block head %}
<meta id="my-data" data-name="graphdata" data-other="{{graphdata}}">
<script src="{{url_for('static', filename='cytoscape.min.js')}}"></script>
{% endblock %}}
{% block grapher %}
  <div id="cy"></div>
  <script>
    new Promise(function(resolve, reject) {
      var graphdata = {{ graphdata|tojson|safe }};
      console.log(graphdata);
      graphdata = jQuery.parseJSON(graphdata);
      console.log(graphdata);
      var followdata = graphdata.follows;
      var users = graphdata.users;
      console.log(graphdata);
      console.log(followdata);
      console.log(users);
      data = []
      
      console.log(data);
      for (var i = 0; i < users.length; i++) {
            user = users[i].id;
            console.log(user)
            data.push({
                data: {id: user}
                }
            );
      };
      console.log(data);
      for (var i = 0; i < followdata.length; i++) {
        var source = followdata[i].from_id;
        var target = followdata[i].to_id;
        console.log(source + " follows " + target)
        data.push({
            data: {
                id: 'edge' + i,
                source: source.toString(10),
                target: target.toString(10)
            }
        });
      };
      console.log(data);
      
      setTimeout(() => resolve(data), 100); // (*)

    }).then(function(data) {
      var cy = window.cy = cytoscape({
      container: document.getElementById('cy'),

      boxSelectionEnabled: false,
      autounselectify: true,

      layout: {
        name: 'concentric',
        concentric: function( node ){
          return node.degree();
        },
        levelWidth: function( nodes ){
          return 2;
        }
      },

      style: [
        {
          selector: 'node',
          style: {
            'height': 20,
            'width': 20,
            'background-color': '#30c9bc'
          }
        },

        {
          selector: 'edge',
          style: {
            'curve-style': 'haystack',
            'haystack-radius': 0,
            'width': 5,
            'opacity': 0.5,
            'line-color': '#a8eae5'
          }
        }
      ],

      elements: data
    });
  });
        </script>
{% endblock %}